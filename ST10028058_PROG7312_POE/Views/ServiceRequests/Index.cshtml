@model IEnumerable<ST10028058_PROG7312_POE.Models.ServiceRequestModel>
@{
    ViewData["Title"] = "Service Requests";
    string selectedStatus = ViewBag.Status as string ?? "";
}

<div class="container mt-4">
    <h2>My Service Requests</h2>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    <div class="mb-3">
        <a class="btn btn-success" asp-action="Create">Submit New Request</a>
    </div>

    <form method="get" class="row g-2 mb-4">
        <div class="col-md-4">
            <input name="q" value="@ViewBag.Search" placeholder="Search title or description" class="form-control" />
        </div>
        <div class="col-md-3">
            <select name="status" class="form-select">
                <option value="" selected="@string.IsNullOrEmpty(selectedStatus)">All statuses</option>
                <option value="Pending" selected="@(selectedStatus == "Pending")">Pending</option>
                <option value="InProgress" selected="@(selectedStatus == "InProgress")">In Progress</option>
                <option value="Completed" selected="@(selectedStatus == "Completed")">Completed</option>
                <option value="Cancelled" selected="@(selectedStatus == "Cancelled")">Cancelled</option>
            </select>
        </div>
        <div class="col-md-3">
            <input name="area" value="@ViewBag.Area" placeholder="Area" class="form-control" />
        </div>
        <div class="col-md-2">
            <button class="btn btn-outline-success w-100" type="submit">Filter</button>
        </div>
    </form>

    @if (!Model.Any())
    {
        <div class="alert alert-info">No service requests found.</div>
    }
    else
    {
        <div class="row">
            @foreach (var req in Model)
            {
                <div class="col-md-6 mb-3">
                    <div class="card shadow-sm border-0">
                        <div class="card-body">
                            <h5>@req.Title</h5>
                            <p class="text-muted mb-1">@req.Category • @req.Area</p>
                            <p class="text-muted small">Submitted: @req.DateSubmitted.ToLocalTime().ToString("yyyy-MM-dd HH:mm")</p>
                            <p>
                                <span class="badge bg-secondary">@req.Status</span>
                                <span class="badge bg-info text-dark ms-1">Priority: @req.Priority</span>
                            </p>
                            <a class="btn btn-sm btn-outline-success" asp-action="ViewRequest" asp-route-id="@req.RequestId">View</a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>
