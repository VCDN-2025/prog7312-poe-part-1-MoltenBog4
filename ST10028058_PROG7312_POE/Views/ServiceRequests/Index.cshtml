@model IEnumerable<ST10028058_PROG7312_POE.Models.ServiceRequestModel>
@{
    ViewData["Title"] = "All Service Requests";
}

<div class="container mt-5 mb-5">
    <!-- Header with New Request Button -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold text-dark mb-0">📋 My Service Requests</h2>
        <a asp-action="Create" class="btn btn-gradient fw-bold text-white shadow-sm">
            <i class="bi bi-plus-circle me-1"></i> New Request
        </a>
    </div>

    <!-- Alerts -->
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success shadow-sm">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger shadow-sm">@TempData["Error"]</div>
    }

    <!-- FILTER BAR -->
    <form method="get" class="row g-2 align-items-center mb-4 shadow-sm p-3 rounded-4" style="background:#f8f9fa;">
        <!-- Keyword Search -->
        <div class="col-md-3">
            <div class="input-group">
                <span class="input-group-text bg-white border-end-0">
                    <i class="bi bi-search text-muted"></i>
                </span>
                <input type="text" name="q" value="@ViewBag.Search" class="form-control border-start-0"
                       placeholder="Search title, area, or category..." />
            </div>
        </div>

        <!-- Status Filter -->
        <div class="col-md-3">
            <select name="status" class="form-select">
                <option value="">All Statuses</option>
                <option value="Pending" selected="@(ViewBag.SelectedStatus == "Pending")">Pending</option>
                <option value="InProgress" selected="@(ViewBag.SelectedStatus == "InProgress")">In Progress</option>
                <option value="Completed" selected="@(ViewBag.SelectedStatus == "Completed")">Completed</option>
                <option value="Cancelled" selected="@(ViewBag.SelectedStatus == "Cancelled")">Cancelled</option>
            </select>
        </div>

        <!-- Priority Filter -->
        <div class="col-md-3">
            <select name="priority" class="form-select">
                <option value="">All Priorities</option>
                <option value="1" selected="@(ViewBag.SelectedPriority == 1)">Critical</option>
                <option value="2" selected="@(ViewBag.SelectedPriority == 2)">High</option>
                <option value="3" selected="@(ViewBag.SelectedPriority == 3)">Medium</option>
                <option value="4" selected="@(ViewBag.SelectedPriority == 4)">Low</option>
                <option value="5" selected="@(ViewBag.SelectedPriority == 5)">Very Low</option>
            </select>
        </div>

        <!-- Category Filter -->
        <div class="col-md-2">
            <select name="category" class="form-select">
                <option value="">All Categories</option>
                @if (ViewBag.Categories != null)
                {
                    foreach (var c in ViewBag.Categories)
                    {
                        <option value="@c" selected="@(ViewBag.SelectedCategory == c)">@c</option>
                    }
                }
            </select>
        </div>

        <!-- Filter & Reset Buttons -->
        <div class="col-md-1 d-flex gap-2">
            <button class="btn btn-gradient fw-bold w-100" type="submit">Filter</button>
            <a href="@Url.Action("Index", "ServiceRequests")" class="btn btn-outline-danger fw-bold w-100">Reset</a>
        </div>
    </form>

    <!-- No Requests -->
    @if (!Model.Any())
    {
        <div class="alert alert-info text-center shadow-sm py-3">You haven’t submitted any service requests yet.</div>
    }
    else
    {
        <div class="card shadow-lg border-0 rounded-4 overflow-hidden">
            <div class="card-header text-white py-3" style="background: linear-gradient(90deg, #0d6efd, #20a8d8);">
                <h5 class="fw-bold mb-0"><i class="bi bi-clipboard-check me-2"></i>Your Submitted Requests</h5>
            </div>

            <div class="card-body bg-light p-3">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0 rounded-3 overflow-hidden shadow-sm">
                        <thead class="table-primary text-dark">
                            <tr>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Area</th>
                                <th>Category</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Date Submitted</th>
                                <th>Last Updated</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white">
                            @foreach (var r in Model)
                            {
                                string statusClass = r.Status.ToString() switch
                                {
                                    "Pending" => "status-pending",
                                    "InProgress" => "status-inprogress",
                                    "Completed" => "status-completed",
                                    "Cancelled" => "status-cancelled",
                                    _ => "status-default"
                                };

                                string priorityClass = r.Priority switch
                                {
                                    1 => "priority-critical",
                                    2 => "priority-high",
                                    3 => "priority-medium",
                                    4 => "priority-low",
                                    5 => "priority-low",
                                    _ => "priority-default"
                                };

                                string priorityLabel = r.Priority switch
                                {
                                    1 => "Critical",
                                    2 => "High",
                                    3 => "Medium",
                                    4 => "Low",
                                    5 => "Very Low",
                                    _ => "Unspecified"
                                };

                                <tr>
                                    <td>@r.RequestId</td>
                                    <td>@r.Title</td>
                                    <td>@r.Area</td>
                                    <td>@r.Category</td>
                                    <td><span class="badge @priorityClass px-2 py-1">@priorityLabel</span></td>
                                    <td><span class="badge @statusClass px-3 py-2 text-uppercase">@r.Status</span></td>
                                    <td>@r.DateSubmitted.ToLocalTime().ToString("yyyy-MM-dd")</td>
                                    <td>@r.LastUpdated.ToLocalTime().ToString("yyyy-MM-dd HH:mm")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
</div>

<!-- Custom Styling -->
<style>
    .btn-gradient {
        background: linear-gradient(90deg, #0d6efd, #20a8d8);
        border: none;
        transition: all 0.2s ease-in-out;
    }

        .btn-gradient:hover {
            transform: translateY(-1px);
            background: linear-gradient(90deg, #0b5ed7, #138496);
        }

    .status-pending {
        background-color: #ffc107;
        color: #000;
        font-weight: 600;
    }

    .status-inprogress {
        background-color: #17a2b8;
        color: #fff;
        font-weight: 600;
    }

    .status-completed {
        background-color: #28a745;
        color: #fff;
        font-weight: 600;
    }

    .status-cancelled {
        background-color: #dc3545;
        color: #fff;
        font-weight: 600;
    }

    .priority-critical {
        background-color: #dc3545 !important;
        color: #fff !important;
    }

    .priority-high {
        background-color: #fd7e14 !important;
        color: #fff !important;
    }

    .priority-medium {
        background-color: #ffc107 !important;
        color: #000 !important;
    }

    .priority-low {
        background-color: #6c757d !important;
        color: #fff !important;
    }

    thead th {
        font-weight: 600;
        background-color: #eaf3ff !important;
    }

    tbody tr:hover {
        background-color: #f5f9ff;
        transition: background-color 0.2s ease;
    }
</style>
